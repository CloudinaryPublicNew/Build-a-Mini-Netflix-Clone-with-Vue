# Create Movies

As a final task, take the modal in the preceding section live.


## Upload Modal Trigger

To upload the modal trigger:

1. Add a button to the navigation bar for launching the upload modal on a click:

  ```html
  <div class="navbar-menu">
  <div class="navbar-end">
  !showModal">
      Upload
      </a>
    </div>
  </div>
  ```
Every time you click that button, it flips a `showModal` boolean. Add the property to the data model:

  ```js
  showModal: false,
  ```

2. Add the `UploadModal` to the `App` component as a child. Start with adding the element immediately below the container `div`:

  ```html
  <UploadModal :showModal="showModal" @handle-       
  upload="uploadToServer"></UploadModal>
  ```

  Note that you are passing down the `showModal` to the component. You will learn about the `handle-upload` event later.

3.  Import the `UploadModal` to `App`:

  ```js
  import UploadModal from './components/UploadModal.vue';

  export default {
    //...
  components: {
    //...
  UploadModal
    }
  }
  ```

## Watch `showModal`

You show the modal according to the value of the `showModal` prop in the `UploadModal` component:

```js
watch: {
  showModal(val) {
    val ? this.$refs.modal.open() : this.$refs.modal.close();
  }
},
```

Click the **Upload** button for the modal:

![](https://d2mxuefqeaa7sj.cloudfront.net/s_C4E0BB4A3CA481FA22D9AA6239D953F2B1D94D00408DB28F7AB567E3C6C4DB1A_1521628075318_Screen+Shot+2018-03-21+at+11.27.25+AM.png)

## Upload an Image or a Video

On a click of each of the upload buttons on the modal, the `startUpload` method is called but with different arguments. Create that method as follows:

```js
methods: {
  startUpload(type) {
    cloudinary.openUploadWidget(
      { cloud_name: 'christekh', upload_preset: 'idcidr0h' },
      (error, result) => {
        console.log(error, result[0]);
        type === 'banner'
          ? (this.banner = result[0].public_id)
          : (this.trailer = result[0].public_id);
      }
    );
  },
},
```

`startUpload` launches the upload widget, which enables you to upload images or videos. After the upload, depending on which button was clicked, set the value to reflect the banner or trailer model.

Apart from `cloud_name`, you must also create an unsigned `upload_preset` to enable uploads. To do that, fill in the fields on [Cloudinary's upload settings page](https://cloudinary.com/console/settings/upload).

> *MS: Is "fill in the fields" above correct? I don't have a Cloudinary account and can't access that page to verify.

The upload widget uses another library for modularity. Add the following code below the scripts in the `public/index.html` file:

```html
<script src="//widget.cloudinary.com/global/all.js" type="text/javascript"></script>  
```

Click the **Upload** button on the modal and you should see the widget appear:

![](https://d2mxuefqeaa7sj.cloudfront.net/s_C4E0BB4A3CA481FA22D9AA6239D953F2B1D94D00408DB28F7AB567E3C6C4DB1A_1521628982263_Screen+Shot+2018-03-21+at+11.42.14+AM.png)

## Emitting an Upload Event

The form has a `handleUpload` event attached to it. When the submit button is clicked, we must have set the title and the Ids for the media contents. This method checks if those values are available before emitting an event to the parent component to perform the upload.

Add this to the methods object:

```js
handleUpload() {
  const data = {
    title: this.title,
    banner: this.banner,
    trailer: this.trailer
  };
  if (data.title && this.banner && this.trailer)
    this.$emit('handle-upload', data);
}
```

## Uploading to the Server

Recall the element for `UploadModal` looks like this:

```html
<UploadModal :showModal="showModal" @handle-upload="uploadToServer"></UploadModal>
```

The `uploadToServer` method is the hander for the event emitted in the child component. Create the method in the methods object:

```js
uploadToServer(data) {
  axios.post(this.url, data).then(res => {
    this.movies = [...this.movies, res.data];
    this.showModal = false;
  })
}
```

The method pushes to the server and updates the list with the new entry. It also hides the modal.

This is how the App component script looks like:

```js
import axios from 'axios';
import VideoPlayer from './components/VideoPlayer.vue';
import VideoList from './components/VideoList.vue';
import UploadModal from './components/UploadModal.vue';

export default {
  data() {
    return {
      movie: {},
      movies: [],
      showModal: false,
      url: 'https://wt-nwambachristian-gmail_com-0.run.webtask.io/server/movies'
    }
  },
  created() {
    this.cloudinaryInstance = window.cloudinary.Cloudinary.new({
      cloud_name: 'christekh',
      secure: true
    });
    axios.get(this.url)
      .then(res => {
        this.movies = res.data;
      })
  },
  methods: {
    updatePlayer(movie) {
      this.movie = movie;
    },
    uploadToServer(data) {
      axios.post(this.url, data).then(res => {
        this.movies = [...this.movies, res.data];
        this.showModal = false;
      })
    }
  },
  components: {
    VideoPlayer,
    VideoList,
    UploadModal
  }
};
```
